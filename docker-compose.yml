services:
  vllm:
    image: nvcr.io/nvidia/vllm:26.01-py3
    command: >-
      vllm serve mesolitica/Qwen2.5-72B-Instruct-FP8
      --host 0.0.0.0
      --port 8000
      --max-model-len 32768
      --gpu-memory-utilization 0.85
      --enforce-eager
      --swap-space 16
      --max-num-seqs 4
      --enable-auto-tool-choice
      --tool-call-parser hermes
    volumes:
      - ~/.cache/huggingface:/root/.cache/huggingface
    ports:
      - "8000:8000"
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
    restart: unless-stopped
    networks:
      - pydantic-net

  searxng:
    image: searxng/searxng:latest
    volumes:
      - ~/searxng/config:/etc/searxng
    restart: unless-stopped
    networks:
      - pydantic-net

  pydantic-bot:
    build: .
    env_file: .env
    volumes:
      - ~/projects/pydantic-assets/gog:/app/gog:ro
    depends_on:
      - vllm
      - searxng
    restart: unless-stopped
    networks:
      - pydantic-net

networks:
  pydantic-net:
    driver: bridge
